---
layout: post
title: Development Standards
permalink: Development_Standards.html
category: توسعه
---

<p>The purpose of this document is to outline the development standards for use whilst developing MyBB. Plugin and modification authors are recommended to use these coding standards when developing plugins and modifications.
</p><p>These coding standards were written for the MyBB 1.4.x and MyBB 1.6.x series.
</p>
<table id="toc" class="toc"><tr><td><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Coding_Standards"><span class="tocnumber">1</span> <span class="toctext">Coding Standards</span></a>
<ul>
<li class="toclevel-2 tocsection-2"><a href="#File_Formats"><span class="tocnumber">1.1</span> <span class="toctext">File Formats</span></a></li>
<li class="toclevel-2 tocsection-3"><a href="#Indenting"><span class="tocnumber">1.2</span> <span class="toctext">Indenting</span></a></li>
<li class="toclevel-2 tocsection-4"><a href="#New_Lines"><span class="tocnumber">1.3</span> <span class="toctext">New Lines</span></a></li>
<li class="toclevel-2 tocsection-5"><a href="#Whitespace"><span class="tocnumber">1.4</span> <span class="toctext">Whitespace</span></a></li>
<li class="toclevel-2 tocsection-6"><a href="#PHP_Code_Demarcation"><span class="tocnumber">1.5</span> <span class="toctext">PHP Code Demarcation</span></a></li>
<li class="toclevel-2 tocsection-7"><a href="#Strings"><span class="tocnumber">1.6</span> <span class="toctext">Strings</span></a></li>
<li class="toclevel-2 tocsection-8"><a href="#Variables"><span class="tocnumber">1.7</span> <span class="toctext">Variables</span></a></li>
<li class="toclevel-2 tocsection-9"><a href="#Arrays"><span class="tocnumber">1.8</span> <span class="toctext">Arrays</span></a></li>
<li class="toclevel-2 tocsection-10"><a href="#Control_Structures"><span class="tocnumber">1.9</span> <span class="toctext">Control Structures</span></a></li>
<li class="toclevel-2 tocsection-11"><a href="#Functions_and_Methods"><span class="tocnumber">1.10</span> <span class="toctext">Functions and Methods</span></a></li>
<li class="toclevel-2 tocsection-12"><a href="#Passing_by_Reference"><span class="tocnumber">1.11</span> <span class="toctext">Passing by Reference</span></a></li>
<li class="toclevel-2 tocsection-13"><a href="#Class_Declarations"><span class="tocnumber">1.12</span> <span class="toctext">Class Declarations</span></a></li>
<li class="toclevel-2 tocsection-14"><a href="#Constants"><span class="tocnumber">1.13</span> <span class="toctext">Constants</span></a></li>
<li class="toclevel-2 tocsection-15"><a href="#Comments"><span class="tocnumber">1.14</span> <span class="toctext">Comments</span></a></li>
<li class="toclevel-2 tocsection-16"><a href="#Regular_Expressions"><span class="tocnumber">1.15</span> <span class="toctext">Regular Expressions</span></a></li>
<li class="toclevel-2 tocsection-17"><a href="#Arithmetic_Operators"><span class="tocnumber">1.16</span> <span class="toctext">Arithmetic Operators</span></a></li>
<li class="toclevel-2 tocsection-18"><a href="#Banned_Practices"><span class="tocnumber">1.17</span> <span class="toctext">Banned Practices</span></a></li>
<li class="toclevel-2 tocsection-19"><a href="#Sanitizing_Data_for_Output"><span class="tocnumber">1.18</span> <span class="toctext">Sanitizing Data for Output</span></a></li>
<li class="toclevel-2 tocsection-20"><a href="#PHPDocumenter_Standards"><span class="tocnumber">1.19</span> <span class="toctext">PHPDocumenter Standards</span></a></li>
<li class="toclevel-2 tocsection-21"><a href="#Chaperone"><span class="tocnumber">1.20</span> <span class="toctext">Chaperone</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-22"><a href="#Database_Standards"><span class="tocnumber">2</span> <span class="toctext">Database Standards</span></a>
<ul>
<li class="toclevel-2 tocsection-23"><a href="#Database_Queries"><span class="tocnumber">2.1</span> <span class="toctext">Database Queries</span></a></li>
<li class="toclevel-2 tocsection-24"><a href="#Simple_Select_Queries"><span class="tocnumber">2.2</span> <span class="toctext">Simple Select Queries</span></a></li>
<li class="toclevel-2 tocsection-25"><a href="#Insert_Queries"><span class="tocnumber">2.3</span> <span class="toctext">Insert Queries</span></a></li>
<li class="toclevel-2 tocsection-26"><a href="#Update_Queries"><span class="tocnumber">2.4</span> <span class="toctext">Update Queries</span></a></li>
<li class="toclevel-2 tocsection-27"><a href="#Delete_Queries"><span class="tocnumber">2.5</span> <span class="toctext">Delete Queries</span></a></li>
<li class="toclevel-2 tocsection-28"><a href="#Sanitization"><span class="tocnumber">2.6</span> <span class="toctext">Sanitization</span></a></li>
</ul>
</li>
</ul>
</td></tr></table>
<h1> <span class="mw-headline" id="Coding_Standards"> Coding Standards </span></h1>
<h2> <span class="mw-headline" id="File_Formats"> File Formats </span></h2>
<p>All files must be saved as UNIX formatted files using the ASCII character set.
</p>
<h2> <span class="mw-headline" id="Indenting"> Indenting </span></h2>
<p>All indentation should be performed using the [TAB] key. The text editor should also be set to save tabs and indentation as the TAB character and not spaces.
</p>
<h2> <span class="mw-headline" id="New_Lines"> New Lines </span></h2>
<p>All new lines should be the unix line feed (\n) and <b>not</b> the windows carriage return (\r)
</p>
<h2> <span class="mw-headline" id="Whitespace"> Whitespace </span></h2>
<p>Whitespace (new lines) should be used to separate logical areas of code so that it’s easier to read.
</p><p>Trailing whitespace on the end of lines or end of files is not permitted. Most text editors have a preference to automatically trim trailing whitespace.
</p>
<h2> <span class="mw-headline" id="PHP_Code_Demarcation"> PHP Code Demarcation </span></h2>
<p>Short PHP open and close tags (&lt;? and&#160;?&gt;, &lt;?= and&#160;?&gt;) are not permitted.  To delimit PHP code, the full &lt;?php&#160;?&gt; tags must be used as this is the most portable way to include PHP code on differing PHP configurations.
</p>
<h2> <span class="mw-headline" id="Strings"> Strings </span></h2>
<p>When a string is literal (contains no variable substitutions), the apostrophe or ‘single quote’ must be used to demarcate the string:
</p>
<pre>
$a = 'Example String';
</pre>
<p>When a literal string itself contains apostrophes, it is permitted to demarcate the string with quotation marks or “double quotes”. This is especially encouraged for SQL statements:
</p>
<pre>
$query = &quot;SELECT id, name FROM people WHERE name='Joe Bloggs'&quot;;
</pre>
<p>Variable substitution is permitted in strings using either of the following forms:
</p>
<pre>
$example = &quot;Hello &quot;.$name.&quot;, welcome back&quot;;
$example = 'Hello '.$name.', welcome back!';
$example = &quot;Hello {$name}, welcome back!&quot;;
</pre>
<p>String concatenation should be performed by terminating the string with a period (.) . To help improve readability, if concatenation is required in a large string, it’s recommended to separate it in to appended variables:
</p>
<pre>
$example = 'Hello';
$example .= $name;
</pre>
<h2> <span class="mw-headline" id="Variables"> Variables </span></h2>
<p>Variable names may only contain alphanumeric characters. To promote variable readability, underscores may be used in variable names to indicate a space or new word.
</p><p>For class member variables, the variable declaration must be prefixed as either public, private or protected. Declaration as var, is discouraged. Examples include:
</p>
<pre>
$var = &quot;example&quot;;
class Example
{
	private $sample_variable = true;
	public $example_variable_name = 'sample';
}
</pre>
<p>Verbosity is encouraged. Variables should always be as verbose as possible to describe what they contain. Terse variable names such as $i and $n are discouraged for anything other than small loop contexts. The use of variables such as $tmp and $temp are also not permitted.
</p>
<h2> <span class="mw-headline" id="Arrays"> Arrays </span></h2>
<p>Array item declarations should each be on their own new line and indented to promote readability in the block.
</p>
<pre>
$array = array(
	&quot;item&quot; =&gt; &quot;value&quot;,
	&quot;item2&quot; =&gt; array(
		1,
		2
	)
);
</pre>
<h2> <span class="mw-headline" id="Control_Structures"> Control Structures </span></h2>
<p>Control structures include if, for, while, and switch statements. Curly braces should always be used even in situations where they are optional. Ternary operators are not permitted and should not be used.
</p><p>Within a control structure, operators must be separated by spaces for readability. The opening brace must be written on it’s own line directly under the conditional. The closing brace is also written on it’s own line. Any content within braces must be indented.
</p>
<pre>
if($example&#160;!= &quot;sample&quot;)
{
	$example = &quot;sample&quot;;
}
else
{
	$example = &quot;test&quot;;
}
</pre>
<p>Control structures should be kept as simple as possible and large nested if structures should also be avoided. An alternative to using an else would be to return before the if statement.
</p><p>Example switch statement:
</p>
<pre>
switch($example)
{
	case &quot;example&quot;:
		$example = &quot;sample&quot;;
		break;
}
</pre>
<p>For the sake of code simplicity, variable assignment in conditionals is also not supported. The variable should be assigned out of the conditional and the conditional simply check the variable value. For example:
</p>
<pre>
if(($result = $db-&gt;query(&quot;SELECT * FROM table&quot;)) &amp;&amp; ($row = $db-&gt;fetch_array($result)) &amp;&amp; $example == 1)
{
	…
}
</pre>
<p>Should be written as:
</p>
<pre>
$result = $db-&gt;query(“SELECT * FROM table”);
$row = $db-&gt;fetch_array($query);
if($row &amp;&amp; $example == 1)
{
	…
}
</pre>
<h2> <span class="mw-headline" id="Functions_and_Methods"> Functions and Methods </span></h2>
<p>Function names may only contain lowercase alphanumeric characters. Underscores are also permitted to increase function naming readability and should be used when a function name consists of more than one word. The opening brace for a function should be placed on a new line.
</p><p>Every function must have a documentation block that conforms to the PHPDocumentor standard (covered below).
</p><p>Function names should start with a verb describing the action that is being performed. Acceptable function names include:
</p>
<pre>
filter_input()
get_element_by_id()
cache_file()
get_thread()
</pre>
<p>When calling a function, arguments should be separated by spaces:
</p>
<pre>
$example = get_thread($terms, $argument2);
$threads-&gt;get_threads($terms, $argument3);
</pre>
<p>With regards to including/requiring files, the language construct should be used over the function.
</p>
<pre>
require_once(MYBB_ROOT.&quot;inc/functions.php&quot;); // require_once Function

require_once MYBB_ROOT.&quot;inc/functions.php&quot;; // Language construct - should be used over the above
</pre>
<h2> <span class="mw-headline" id="Passing_by_Reference"> Passing by Reference </span></h2>
<p>Passing variables by reference to functions/methods is permitted on the following terms:
</p>
<ul><li> The function needs to modify/return several variables and returning an array of the data is not plausible.
</li><li> The function does not contain a true/false return value. In this case, the return value of the function should be the variable or false in the case of an error.
</li></ul>
<h2> <span class="mw-headline" id="Class_Declarations"> Class Declarations </span></h2>
<p>Class names should be as descriptive as possible. Avoid using abbreviations where possible. Class names should begin with an uppercase character and words should be separated by an underscore.  The brace must always be written on the line underneath the class name (“one true brace” form). 
</p><p>Every class must have a documentation block that conforms to the PHPDocumentator standard (covered below).
</p>
<pre>
class Plugin_System
{
	private $example;
}
</pre>
<h2> <span class="mw-headline" id="Constants"> Constants </span></h2>
<p>Constants may contain both underscores and alphanumeric characters. All letters must be capitalized and to enhance readability, words in constant names must be separated by underscore characters. For example, MYBB_ROOT.
</p><p>Boolean and null value constants (true, false and null) however, should be completely lowercase.
</p>
<h2> <span class="mw-headline" id="Comments"> Comments </span></h2>
<p>Non-documentation comments are strongly encouraged. As a general rule of thumb, if you look at a block of code and think “Wow, I don’t want to try and describe that”, it obviously needs to be commented to explain what’s happening.
</p><p>C style comments (/* */) and standard C++ comments (//) are both permitted whilst the use of Perl and shell style comments (#) are not.
</p>
<h2> <span class="mw-headline" id="Regular_Expressions"> Regular Expressions </span></h2>
<p>Use of the POSIX Extended based regular expression functions (eregi, eregi_replace, etc) is not permitted. Instead, the Perl Compatible (PCRE) regular expression functions such as preg_replace, preg_match should be used.
</p><p>Regular expression patterns should be encapsulated in single quotes (although double are permitted) to prevent the possibility of interference with reserved PHP characters (such as $)
</p><p>Careful attention needs to be paid when using regular expressions, as there may be a standard PHP string or other function that performs the same task much quicker than a regular expression.
</p>
<h2> <span class="mw-headline" id="Arithmetic_Operators"> Arithmetic Operators </span></h2>
<p>When increasing or decreasing the value of a variable, the arithmetic operator (++ or --) should be on the left hand side of the variable. For example:
</p>
<pre>
$test = 1;
++$test;
echo $test // Will echo 2
</pre>
<h2> <span class="mw-headline" id="Banned_Practices"> Banned Practices </span></h2>
<ul><li> It is not permitted to use the sprintf function for variable substitution in strings. Instead, standard string concatenation should be used. Use of a sprintf statement with 20 replacement values spread over 10 lines is far more difficult to maintain than substituted variables.
</li><li> Use of the ereg regular expression library is also not permitted. Instead, the PCRE regular expression library should be used.
</li></ul>
<h2> <span class="mw-headline" id="Sanitizing_Data_for_Output"> Sanitizing Data for Output </span></h2>
<p>Before any data is output to the browser that has had the possibility of user-manipulation (such as data pulled from the database that has been previously inserted through a web interface), the data must be cleaned/filtered to its expected format.
</p><p>For example, if you are expecting an integer, you may typecast the item to that format:
</p>
<pre>
$variable = (int)$variable;
</pre>
<p>For other kinds of data, such as a thread name where the value is user generated text, it should be sanitized using the htmlspecialchars_uni() function that will replace unwanted characters with their HTML entity equivalents:
</p>
<pre>
$variable = htmlspecialchars_uni($variable);
</pre>
<h2> <span class="mw-headline" id="PHPDocumenter_Standards"> PHPDocumenter Standards </span></h2>
<p>PHPDoc comments are a way of documenting what a function, class, or variable is used for. They’re used to build developer documentation and provide general reference.
</p><p>Preceding every function, class or method declaration, there should be an associated PHPDoc comment block. The documentation block must describe the function (on one or more lines), provide a list of parameter variables and a possible return values.
</p><p>Each line of the PHPDoc comment must contain an asterisk that sits below the previous asterisk.
</p><p>The accepted format for class member variables (@var) is as follows:
</p>
<pre>
@var (lowercase variable type) (variable description)
@access (public|private|protected)
For example:
@var object The database object.
@access private
The accepted format for parameter variables (@param) is as follows:
@param (lowercase variable type) (variable description)
For example:
@param string The name of the thread to search for.
The accepted format for the return value (@return) is as follows:
@return (lowercase variable type) (variable description)
For example:
@return array Array of matching threads.
</pre>
<p>A complete example is shown below.
</p>
<pre>
/**
 * A class for searching for threads in the database.
 */
class Thread_Search
{
	/**
	 * @var object The database object.
	 * @access private
	 */
	private $db;
	
	/**
	 * Get a list of threads with the specified name.
	 *
	 * @param string The thread name to search for.
	 * @param int Find threads in this particular forum (Forum ID)
	 * @return array An array of matching threads.
	 */
	public function get_threads($terms, $forum_id=0)
	{
		...
	}
}
</pre>
<h2> <span class="mw-headline" id="Chaperone"> Chaperone </span></h2>
<p><b>(Not fully implemented yet)</b>
</p><p>Chaperone help keeps our code clean. Whenever you attempt to commit in to the MyBB subversion repositories, Chaperone will run with your changes and compare them with a list of coding standards rules.
</p><p>If one or more of these rules are violated, Chaperone will not allow your commit to make it in to the repository. You’ll see a list of errors and they file they’re in (as well as line number) that you need to fix before your commit will make it in to the repository.
</p><p>Most of the standards mentioned above are checked by Chaperone when a commit takes place. Chaperone will also scan your files for parse errors and check the file format of each file before it’s added to the repository.
</p>
<h1> <span class="mw-headline" id="Database_Standards"> Database Standards </span></h1>
<h2> <span class="mw-headline" id="Database_Queries"> Database Queries </span></h2>
<p>Database queries should be broken up over multiple lines to promote code readability. Reserved words such as SELECT, WHERE and ORDER BY should be written us uppercase characters.  Table and column names may be lowercase. All variable values must be enclosed within quotes. Each query should start on a new line, indented from the variable above to also promote readability. An example is shown below.
</p>
<pre>
$query = &quot;
	SELECT *
	FROM test
&quot;;
</pre>
<pre>
$query = &quot;
SELECT t1.column1, t2.column2
FROM table1 t1
LEFT JOIN table2 t2 ON (t1.column1=t2.column2)
ORDER BY t1.column1 ASC;
&quot;;
</pre>
<h2> <span class="mw-headline" id="Simple_Select_Queries"> Simple Select Queries </span></h2>
<p>Database select queries which do not involve any joins or advanced grouping, etc can use simple_select(). The simple_select method takes a table name, the rows to be returned, a where clause and an array of ordering and limiting options. Example use is as follows:
</p>
<pre>
$query = $db-&gt;simple_select(&quot;table&quot;, &quot;*&quot;, &quot;id='123'&quot;, array('order_by' =&gt; 'column2', 'order_dir' =&gt; 'DESC',
'limit_start' =&gt; 0, 'limit' =&gt; 5));
</pre>
<h2> <span class="mw-headline" id="Insert_Queries"> Insert Queries </span></h2>
<p>Database insert queries should be performed using the insert_query() method. The insert_query method takes both a table name and an associative array of values to be inserted. Values MUST escaped using the escape_string method. Example use is as follows:
</p>
<pre>
$new_record = array(
	&quot;column&quot; =&gt; $db-&gt;escape_string('test'),
	&quot;column2&quot; =&gt; 1
);
$db-&gt;insert_query('table', $new_record);
</pre>
<h2> <span class="mw-headline" id="Update_Queries"> Update Queries </span></h2>
<p>Update queries follow a similar structure to insert queries, however make use of the update_query method. The update_query method takes a table name, an associative array of values to update, and optionally any conditions that must be matched (the WHERE clause of an update query).
</p><p>Values MUST be escaped and any conditions need to be explicitly escaped using the escape_string() method. Example use is as follows:
</p>
<pre>
$updated_record = array(
	&quot;column&quot; =&gt; $db-&gt;escape_string('Value')
);
$db-&gt;update_query('table', $updated_record, &quot;condition1='&quot;.$db-&gt;escape_string('test').&quot;'&quot;);
</pre>
<h2> <span class="mw-headline" id="Delete_Queries"> Delete Queries </span></h2>
<p>Delete queries should be performed using the delete_query method. This method takes the table name, and optionally any conditions that will need to be matched. The conditions need to be escaped using the escape_string() method as mentioned below. Example use is as follows:
</p>
<pre>
$db-&gt;delete_query('table', 'condition1=value1');
</pre>
<h2> <span class="mw-headline" id="Sanitization"> Sanitization </span></h2>
<p>Before any data, values or variables are used within a query they must be adequately escaped or formatted to their required value for that column. In some cases this may mean typecasting the value to an integer or calling the escape_string() method of the database class to sanitize (escape) the content of the string.
</p><p><br style="clear:both" />
</p>




